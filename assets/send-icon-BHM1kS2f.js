import{E as H,J,r as F,K,c as a,D as N,a as O,g as W,b as Q}from"./index-BpRoBJd6.js";import{u as U}from"./utils-CltBBt4p.js";function Z(y){const{input:g,isStreaming:l,currentThreadId:d,addMessage:c,patchMessage:t,appendContent:o,setStreaming:p,createThread:x,updateSuggestedQuestions:h,activeTab:s,onSubmitReport:w}=y,T=H(),M=J(),u=F(null),V=new K({transport:"sse"});async function B(E,r,e){const f=d.value;if(f){let C=e,I,L,P;return new Promise((v,S)=>{var $,k;const _=V.stream$(f,E,{signal:($=u.value)==null?void 0:$.signal}).subscribe({next:m=>{var A,D;if(m.type==="message"&&m.data){const i=m.data;!i.isComplete&&i.content&&o(r,i.content),i.isComplete&&(i.references&&(C=i.references.map(R=>({name:R.title,content:R.content,score:R.relevanceScore,extra:R.extra}))),i.summary&&(I=i.summary),i.recommendations&&(L=i.recommendations),i.messageId&&(P=i.messageId))}m.type==="error"&&(t(r,{pending:!1,error:((A=m.error)==null?void 0:A.message)||"Unknown error"}),p(!1),S(new Error(((D=m.error)==null?void 0:D.message)||"Stream error")))},error:m=>{t(r,{pending:!1,error:m instanceof Error?m.message:"Unknown error"}),p(!1),S(m)},complete:()=>{t(r,{id:P||r,pending:!1,sources:C.length>0?C:void 0,aiHighlight:I}),h&&L&&h(f,L),v()}});(k=u.value)==null||k.signal.addEventListener("abort",()=>{_.unsubscribe()})})}t(r,{pending:!1,sources:e.length>0?e:void 0})}async function n(E){var P;const r=E.trim();if(!r||l.value)return;if(s==="generate-report"&&w){w(r);return}!d.value&&x&&await x(r,"chat"),g.value="";const f={id:U(),role:"user",content:r,createdAt:Date.now()};c(f);const C=d.value;if(C){const v=M.path,S=`/chat/${C}`;v!==S&&!v.includes(C)&&T.replace(S)}const I=U();c({id:I,role:"assistant",content:"",createdAt:Date.now(),pending:!0}),(P=u.value)==null||P.abort(),u.value=new AbortController,p(!0);let L=[];try{await B(r,I,L)}catch(v){const S=v instanceof Error?v.message:String(v);t(I,{pending:!1,error:S})}finally{p(!1)}}function b(){u.value&&(u.value.abort(),p(!1))}return{submit:n,stopStreaming:b,abortController:a(()=>u.value)}}function j(y){const{modelValue:g,variant:l,activeTab:d,isFocused:c}=y,t=()=>typeof g=="function"?g():g.value,o=()=>(typeof l=="function"?l():l==null?void 0:l.value)??"chat",p=()=>typeof d=="function"?d():d==null?void 0:d.value,x=()=>typeof c=="function"?c():(c==null?void 0:c.value)??!1,h=a(()=>t().trim().length>0),s=a(()=>{if(!x())return"var(--gray-200)";const n=p();return n?n==="chat"?"var(--cobalt-600)":"var(--violet-600)":"var(--gray-200)"}),w=a(()=>{const n="flex items-center bg-white border transition-colors";return o()==="chat"?`${n} gap-3 rounded-[24px]`:`${n} gap-4 rounded-[16px]`}),T=a(()=>{const n=o();return{borderColor:s.value,padding:n==="chat"?"8px 8px 8px 16px":"16px 16px 16px 24px"}}),M=a(()=>"flex-1 bg-transparent text-gray-900 placeholder:text-gray-600 focus:outline-none text-sm leading-5"),u=a(()=>{const n="flex items-center justify-center cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed transition-opacity";return o()==="chat"?`${n} pr-1`:n}),V=a(()=>h.value?s.value:"var(--gray-200)"),B=a(()=>h.value?"var(--white)":"var(--gray-600)");return{canSubmit:h,borderColor:s,containerClass:w,containerStyle:T,inputClass:M,buttonClass:u,sendIconBgColor:V,sendIconPathColor:B}}function Y(y={}){const{placeholder:g,activeTab:l,variant:d,onSubmitReport:c}=y,t=N(),o=F(""),p=F(!1),x=a({get:()=>o.value,set:e=>{o.value=e}}),h=a(()=>t.isStreaming),s=j({modelValue:o,variant:()=>d,activeTab:()=>l,isFocused:()=>p.value}),w={input:o,isStreaming:a(()=>t.isStreaming),currentThreadId:a(()=>t.currentThreadId),addMessage:t.add,patchMessage:t.patch,appendContent:t.appendContent,setStreaming:t.setStreaming,createThread:async(e,f)=>await t.createThread(e,f),updateSuggestedQuestions:t.updateThreadSuggestedQuestions,activeTab:l,onSubmitReport:c},{submit:T,stopStreaming:M}=Z(w),u=e=>{o.value=e},V=e=>{const f=e.target;u(f.value)},B=e=>{o.value=e,n(e)};async function n(e){if(l==="generate-report"&&c){c(e);return}await T(e),o.value=""}const b=e=>{p.value=e},E=()=>{b(!0)},r=()=>{b(!1)};return{input:x,isStreaming:h,isFocused:a(()=>p.value),placeholder:g,canSubmit:s.canSubmit,containerClass:s.containerClass,containerStyle:s.containerStyle,inputClass:s.inputClass,buttonClass:s.buttonClass,sendIconBgColor:s.sendIconBgColor,sendIconPathColor:s.sendIconPathColor,submit:n,stopStreaming:M,handleInput:V,handleFocus:E,handleBlur:r,submitWithText:B,setValue:u,setFocused:b}}const q={width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function z(y,g){return W(),O("svg",q,[...g[0]||(g[0]=[Q("rect",{width:"32",height:"32",rx:"16",fill:"currentColor"},null,-1),Q("path",{d:"M11.2668 21.6001L22.9002 16.6134C23.4402 16.3801 23.4402 15.6201 22.9002 15.3868L11.2668 10.4001C10.8268 10.2068 10.3402 10.5334 10.3402 11.0068L10.3335 14.0801C10.3335 14.4134 10.5802 14.7001 10.9135 14.7401L20.3335 16.0001L10.9135 17.2534C10.5802 17.3001 10.3335 17.5868 10.3335 17.9201L10.3402 20.9934C10.3402 21.4668 10.8268 21.7934 11.2668 21.6001Z",class:"icon-path",fill:"var(--icon-path-color, #868E96)"},null,-1)])])}const ee={render:z};export{ee as S,Y as u};

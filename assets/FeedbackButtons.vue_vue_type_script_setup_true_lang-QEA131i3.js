import{r as g,w as B,j as _,a3 as M,h as T,a as u,g as c,b as d,d as L,c as I,u as V,v as $,F as S,s as F,e as x,t as p,m as H,a4 as D,y as E,x as w,a5 as U,a6 as j,B as A,a7 as N,a8 as y}from"./index-BpRoBJd6.js";function ue(t){const a=g(!0);let l=null;const i=()=>{const n=t.value;n&&(l&&(n.removeEventListener("scroll",l),l=null),l=()=>{const m=t.value;if(!m)return;const h=m.scrollTop,k=m.scrollHeight,b=m.clientHeight;h+b>=k-100?a.value=!0:a.value=!1},n.addEventListener("scroll",l))};B(()=>t.value,async n=>{l&&t.value&&(t.value.removeEventListener("scroll",l),l=null),n&&(await T(),i())},{immediate:!0});async function v(){await T(),!(!t.value||!a.value)&&t.value.scrollTo({top:t.value.scrollHeight,behavior:"smooth"})}async function s(){await T(),t.value&&(t.value.scrollTo({top:t.value.scrollHeight,behavior:"smooth"}),a.value=!0)}return _(()=>{l&&t.value&&t.value.removeEventListener("scroll",l)}),{scrollToBottom:v,forceScrollToBottom:s,isAtBottom:M(a)}}const P={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function W(t,a){return c(),u("svg",P,[...a[0]||(a[0]=[d("path",{d:"M13.7069 21.6826C13.5617 21.6826 13.4331 21.6331 13.3209 21.5341C13.2154 21.4352 13.1527 21.3065 13.1329 21.1482C12.9746 20.0795 12.8064 19.179 12.6283 18.4468C12.4501 17.7211 12.2192 17.1241 11.9356 16.6557C11.6519 16.1873 11.2759 15.8146 10.8075 15.5375C10.3457 15.2538 9.75528 15.0262 9.03621 14.8547C8.32374 14.6832 7.43975 14.5282 6.38424 14.3896C6.21272 14.3698 6.07748 14.3072 5.97852 14.2016C5.87957 14.0895 5.83009 13.9542 5.83009 13.7959C5.83009 13.6442 5.87957 13.5155 5.97852 13.41C6.08407 13.2978 6.21931 13.2319 6.38424 13.2121C7.43975 13.0933 8.32704 12.9548 9.04611 12.7965C9.76517 12.6316 10.3589 12.4073 10.8273 12.1236C11.2957 11.8333 11.6717 11.4507 11.9554 10.9757C12.2456 10.5007 12.4765 9.89711 12.648 9.16485C12.8262 8.43259 12.9878 7.52881 13.1329 6.4535C13.1527 6.29518 13.2154 6.16654 13.3209 6.06758C13.4331 5.96863 13.5617 5.91915 13.7069 5.91915C13.8652 5.91915 13.9938 5.96863 14.0928 6.06758C14.1983 6.16654 14.2676 6.29518 14.3006 6.4535C14.4457 7.52881 14.604 8.43259 14.7756 9.16485C14.9537 9.89711 15.1846 10.5007 15.4682 10.9757C15.7585 11.4441 16.1345 11.8234 16.5963 12.1137C17.0647 12.3974 17.6584 12.6217 18.3775 12.7866C19.0966 12.9515 19.9839 13.0933 21.0394 13.2121C21.2043 13.2319 21.3362 13.2978 21.4352 13.41C21.5407 13.5221 21.5935 13.6508 21.5935 13.7959C21.5935 13.9542 21.5407 14.0895 21.4352 14.2016C21.3362 14.3138 21.2043 14.3764 21.0394 14.3896C19.9839 14.5084 19.0933 14.6502 18.3676 14.8151C17.6485 14.9735 17.0548 15.1945 16.5864 15.4781C16.118 15.7618 15.742 16.1411 15.4583 16.6161C15.1747 17.0911 14.9438 17.698 14.7657 18.4369C14.5941 19.1757 14.4391 20.0795 14.3006 21.1482C14.2742 21.3065 14.2082 21.4352 14.1027 21.5341C13.9971 21.6331 13.8652 21.6826 13.7069 21.6826ZM6.86911 10.7184C6.64482 10.7184 6.51618 10.5964 6.48319 10.3523C6.40403 9.69921 6.32157 9.18794 6.2358 8.81851C6.15004 8.44249 6.01151 8.16212 5.8202 7.9774C5.62889 7.78609 5.33862 7.64096 4.9494 7.542C4.56678 7.44305 4.04232 7.3375 3.37603 7.22535C3.12534 7.19236 3 7.06702 3 6.84932C3 6.64482 3.10885 6.52277 3.32655 6.48319C4.00604 6.35785 4.54039 6.2457 4.92961 6.14675C5.31883 6.04119 5.60909 5.89606 5.80041 5.71135C5.99831 5.52663 6.14015 5.25286 6.22591 4.89003C6.31827 4.52719 6.40403 4.01923 6.48319 3.36613C6.51618 3.12204 6.64482 3 6.86911 3C7.08681 3 7.21215 3.11545 7.24514 3.34634C7.3243 4.01263 7.40676 4.53709 7.49252 4.91971C7.58488 5.30234 7.72672 5.5893 7.91803 5.78062C8.10934 5.97193 8.3996 6.11376 8.78883 6.20612C9.17805 6.29188 9.7124 6.38424 10.3919 6.48319C10.4908 6.48979 10.57 6.52937 10.6294 6.60194C10.6953 6.66791 10.7283 6.75037 10.7283 6.84932C10.7283 7.06042 10.6195 7.18577 10.4018 7.22535C9.7157 7.35729 9.17805 7.47603 8.78883 7.58158C8.4062 7.68054 8.11923 7.82567 7.92792 8.01698C7.73661 8.2017 7.59478 8.47877 7.50242 8.8482C7.41006 9.21103 7.3243 9.719 7.24514 10.3721C7.22535 10.471 7.18247 10.5535 7.1165 10.6195C7.05053 10.6854 6.96807 10.7184 6.86911 10.7184Z",fill:"#9C37E6"},null,-1)])])}const z={render:W},Z={class:"flex gap-[8px] items-start w-full"},q={class:"flex flex-col gap-2.5 flex-1"},de=L({__name:"MessageLoading",props:{messages:{},interval:{default:2e3}},setup(t){const a=t,l=g(0);let i=null;const v=I(()=>a.messages.slice(0,l.value+1));return B(()=>a.messages,()=>{a.messages.length>0&&(l.value=0,i&&clearInterval(i),i=setInterval(()=>{l.value<a.messages.length-1&&(l.value=(l.value+1)%a.messages.length)},a.interval))},{immediate:!0}),_(()=>{i&&clearInterval(i)}),(s,n)=>(c(),u("div",Z,[V($(z),{class:"w-6 h-6 shrink-0 mt-0.5"}),d("div",q,[(c(!0),u(S,null,F(v.value,(m,h)=>(c(),u("div",{key:h,class:x(["text-sm leading-[1.6]",[h===l.value?"text-gray-900 font-semibold":"text-gray-600"]])},p(m),3))),128))])]))}}),O={class:"feedback-dialog-content"},G={class:"feedback-chips"},J=["onClick"],K={key:0,class:"feedback-input-container"},Q={class:"feedback-input-wrapper"},R=["maxlength","disabled"],X={key:0,class:"feedback-placeholder"},Y={class:"feedback-counter"},ee=L({__name:"FeedbackDialog",props:{modelValue:{type:Boolean},title:{default:"더 나은 서비스 제공을 위해 피드백을 보내주세요."},chips:{default:()=>[{id:"incorrect-fact",label:"올바른 사실이 아닌 말을 했습니다"},{id:"poor-source",label:"인용한 출처가 별로입니다"},{id:"custom",label:"직접 입력"}]},placeholder:{default:"피드백을 입력해 주세요"},maxLength:{default:50},cancelText:{default:"취소"},confirmText:{default:"피드백 제출"},confirmColor:{default:"primary"},maxWidth:{default:"500"}},emits:["update:modelValue","submit"],setup(t,{emit:a}){const l=t,i=a,v=I({get:()=>l.modelValue,set:r=>{i("update:modelValue",r)}}),s=g(null),n=g(""),m=I(()=>s.value==="custom"),h=I(()=>!s.value||s.value==="custom"&&!n.value.trim()),k=r=>{s.value===r?s.value=null:(s.value=r,r==="custom"&&setTimeout(()=>{const f=document.querySelector(".feedback-textarea");f&&f.focus()},0))},b=()=>{v.value=!1,e()},o=()=>{i("submit",{chipId:s.value||void 0,text:n.value}),e(),v.value=!1},e=()=>{s.value=null,n.value=""};return(r,f)=>(c(),H($(D),{modelValue:v.value,"onUpdate:modelValue":f[1]||(f[1]=C=>v.value=C),title:t.title,"cancel-text":t.cancelText,"confirm-text":t.confirmText,"confirm-color":t.confirmColor,"max-width":t.maxWidth,"confirm-disabled":h.value,onCancel:b,onConfirm:o},{content:E(()=>[d("div",O,[d("div",G,[(c(!0),u(S,null,F(t.chips,C=>(c(),u("button",{key:C.id,class:x(["feedback-chip","cursor-pointer",{active:s.value===C.id}]),onClick:ie=>k(C.id)},p(C.label),11,J))),128))]),m.value?(c(),u("div",K,[d("div",Q,[U(d("textarea",{"onUpdate:modelValue":f[0]||(f[0]=C=>n.value=C),class:"feedback-textarea",maxlength:t.maxLength,disabled:!m.value,rows:"4"},null,8,R),[[j,n.value]]),n.value?w("",!0):(c(),u("div",X,p(t.placeholder),1)),d("div",Y,p(n.value.length)+"/"+p(t.maxLength),1)])])):w("",!0)])]),_:1},8,["modelValue","title","cancel-text","confirm-text","confirm-color","max-width","confirm-disabled"]))}}),te=A(ee,[["__scopeId","data-v-9d992e61"]]),ae={class:"inline-flex items-center"},le=["disabled"],oe=["disabled"],se=["title","disabled"],ne={key:0,class:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},re={key:1,class:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ve=L({__name:"FeedbackButtons",props:{content:{},messageId:{},conversationId:{},initialFeedback:{},showLike:{type:Boolean,default:!0},showDislike:{type:Boolean,default:!0},showCopy:{type:Boolean,default:!0}},setup(t){const a=t,l=g(null),i=g(!1),v=g(!1),s=g(!1),{showSnackbar:n}=N(),m=o=>o==="THUMBS_UP"?"like":o==="THUMBS_DOWN"?"dislike":null;B(()=>a.initialFeedback,o=>{l.value=m(o)},{immediate:!0});const h=async o=>{if(navigator.clipboard&&navigator.clipboard.writeText)try{return await navigator.clipboard.writeText(o),!0}catch(e){console.warn("Clipboard API 실패, fallback 시도:",e)}try{const e=document.createElement("textarea");e.value=o,e.style.position="fixed",e.style.left="-9999px",e.style.top="-9999px",document.body.appendChild(e),e.focus(),e.select();const r=document.execCommand("copy");return document.body.removeChild(e),r}catch(e){return console.error("Fallback 복사 실패:",e),!1}},k=async o=>{if(o==="copy"){await h(a.content)?(i.value=!0,n("클립보드 복사 완료",{variant:"success",timeout:3e3}),setTimeout(()=>i.value=!1,2e3)):n("복사에 실패했습니다. 다시 시도해주세요.",{variant:"error",timeout:3e3});return}if(!a.messageId||!a.conversationId){console.warn("피드백을 위해 messageId와 conversationId가 필요합니다.");return}if(o==="like"){const e=l.value===o;s.value=!0;try{e?(await y.cancelFeedback(a.messageId),l.value=null):(await y.submitThumbsUp(a.messageId,a.conversationId),l.value=o,n("피드백을 제출해주셔서 감사합니다.",{variant:"success",timeout:3e3}))}catch(r){console.error("피드백 제출 실패:",r),n("피드백 제출에 실패했습니다. 다시 시도해주세요.",{variant:"error",timeout:3e3})}finally{s.value=!1}return}if(o==="dislike")if(l.value==="dislike"){s.value=!0;try{await y.cancelFeedback(a.messageId),l.value=null}catch(e){console.error("피드백 취소 실패:",e),n("피드백 취소에 실패했습니다. 다시 시도해주세요.",{variant:"error",timeout:3e3})}finally{s.value=!1}}else v.value=!0},b=async o=>{if(!a.messageId||!a.conversationId){console.warn("피드백을 위해 messageId와 conversationId가 필요합니다.");return}const e=[];if(o.chipId&&o.chipId!=="custom"){const f={"incorrect-fact":"올바른 사실이 아닌 말을 했습니다","poor-source":"인용한 출처가 별로입니다"};e.push(f[o.chipId]||o.chipId)}o.text&&e.push(o.text);const r=e.join(": ");s.value=!0;try{await y.submitThumbsDown(a.messageId,a.conversationId,r),l.value="dislike",n("피드백을 제출해주셔서 감사합니다.",{variant:"success",timeout:3e3})}catch(f){console.error("피드백 제출 실패:",f),n("피드백 제출에 실패했습니다. 다시 시도해주세요.",{variant:"error",timeout:3e3})}finally{s.value=!1}};return(o,e)=>(c(),u("div",ae,[t.showLike?(c(),u("button",{key:0,onClick:e[0]||(e[0]=r=>k("like")),class:x(["p-2 hover:bg-gray-100 rounded-lg transition-colors cursor-pointer",{"bg-gray-100":l.value==="like"}]),disabled:s.value,title:"좋아요"},[...e[4]||(e[4]=[d("svg",{class:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"})],-1)])],10,le)):w("",!0),t.showDislike?(c(),u("button",{key:1,onClick:e[1]||(e[1]=r=>k("dislike")),class:x(["p-2 hover:bg-gray-100 rounded-lg transition-colors cursor-pointer",{"bg-gray-100":l.value==="dislike"}]),disabled:s.value,title:"싫어요"},[...e[5]||(e[5]=[d("svg",{class:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14H5.236a2 2 0 01-1.789-2.894l3.5-7A2 2 0 018.736 3h4.018a2 2 0 01.485.06l3.76.94m-7 10v5a2 2 0 002 2h.096c.5 0 .905-.405.905-.904 0-.715.211-1.413.608-2.008L17 13V4m-7 10h2m5-10h2a2 2 0 012 2v6a2 2 0 01-2 2h-2.5"})],-1)])],10,oe)):w("",!0),t.showCopy?(c(),u("button",{key:2,onClick:e[2]||(e[2]=r=>k("copy")),class:x(["p-2 hover:bg-gray-100 rounded-lg transition-colors relative cursor-pointer",{"bg-green-50":i.value}]),title:i.value?"복사됨!":"복사",disabled:s.value},[i.value?(c(),u("svg",re,[...e[7]||(e[7]=[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(c(),u("svg",ne,[...e[6]||(e[6]=[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])]))],10,se)):w("",!0),V(te,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=r=>v.value=r),onSubmit:b},null,8,["modelValue"])]))}});export{de as _,ve as a,ue as u};
